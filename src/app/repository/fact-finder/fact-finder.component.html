<div class="b47PM-wrapper logged-in">
    <!-- "logged-in" add this class when user login successfully -->

    <!-- Header Part Html Starts -->
    <app-authorised-header></app-authorised-header>
    <!-- Header Part Html Ends -->
    <!-- Main Display Html Starts -->
    <div class="b47PM-center-body">
        <!-- Main Display Html Starts -->
        <div class="container-fluid b47PM-container">
            <div class="row clearfix">
                <div *ngIf="factFinderHistoryError" class="col-sm-12 text-center">
                    <h3>Opps. something went wrong</h3>
                </div>
                <!-- history table -->
                <div *ngIf="!factFinderHistoryError" class="col-sm-12" style="min-height: 300px;">
                    <h3>Fact Finder History</h3>
                    <div class="table-responsive">
                        <table class="table table-bordered wm-table table-borderless">
                            <thead>
                                <tr>
                                    <th>SR NO.</th>
                                    <!-- <th>FILE NAME</th> -->
                                    <th>ADVISOR NAME</th>
                                    <th>STATUS</th>
                                    <th>CREATED AT</th>
                                    <th></th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody [hidden]="factFinderHistory.length == 0">
                                <tr *ngFor="let statement of factFinderHistory; let i = index; odd as isOdd; even as isEven" [class.odd-list]="isEven" [class.even-list]="isOdd">
                                    <td class="truncatequd" style="width: 11%;">{{i + 1}}</td>
                                    <!-- <td class="break-word">
                                        <a (click)="downloadFactFinderStatement(statement)" title="{{statement.fileName}}" class="cursor">{{statement.fileName}}</a>
                                    </td> -->
                                    <td class="">{{statement?.advisorName}}</td>
                                    <td class="">{{statement.status}}</td>
                                    <td class="">{{statement.createdAt}}</td>
                                    <!-- <td class="truncatequd">
                                        <button class="pull-right btn delete-btn" (click)="prepareStatementDelete(statement)">
                                            <i class="fa fa-trash-o" aria-hidden="true"></i>
                                        </button>
                                    </td> -->
                                    <td>
                                        <!--  [disabled]="!sendOtpLoader && statement['approvedByClient']" -->
                                        <button class="pull-right btn btn-primary" [disabled]="sendOtpLoader || statement['approvedByClient']" (click)="sendOtpToClient(statement)"
                                            title="Approve Fact Finder">
                                            APPROVE
                                        </button>
                                        <!-- <i *ngIf="sendOtpLoader" class="fa fa-spinner glyphicon-refresh-animate"></i> -->
                                    </td>
                                    <td>
                                        <button class="pull-right btn delete-btn" (click)="downloadFactFinderStatement(statement)" title="Download">
                                            <i class="fa fa-download" aria-hidden="true"></i>
                                        </button>
                                        <button class="pull-right btn delete-btn" (click)="previewFactFinder(statement)" title="Review">
                                            <i class="fa fa-eye" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                            <tbody [hidden]="factFinderHistory.length != 0">
                                <tr>
                                    <td style="text-align: center;" colspan="9">There are no any Fact Finder.</td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="clearfix"></div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Footer Part Html Starts -->
    <app-authorised-footer></app-authorised-footer>
    <!-- Footer Part Html Ends -->
</div>

<ng-template #deleteFactFinderHistoryModal>
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" [disabled]="delFactFinderHistoryLoading" (click)="closeDeleteStatementModal()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <div class="row clearfix">
            <div class="col-md-12" align="center">
                <p>Are you sure want to delete permanently.</p>
            </div>
            <div class="col-md-12 pm-red" align="center">
                <span id="delStatementRepoError"></span>
            </div>
            <div class="col-md-12" align="center">
                <img *ngIf="delFactFinderHistoryLoading" src="/assets/img/loader/spin.gif" />
                <input type="button" class="b47PM-deltran-btn" [disabled]="delFactFinderHistoryLoading" value="DELETE" (click)="deleteStatement()">
                <input type="button" [disabled]="delFactFinderHistoryLoading" (click)="closeDeleteStatementModal()" class="b47PM-dCancel-btn"
                    data-dismiss="modal" value="CANCEL">
            </div>
        </div>
    </div>
</ng-template>

<ng-template #pdfPreviewModal>
    <div class="modal-header">
        <button type="button" (click)="closePdfPreviewModal()" class="close">
            <span aria-hidden="true">&times;</span>
        </button>
        <h3 class="modal-title">PDF Preview</h3>
    </div>
    <div class="modal-body">
        <div class="row">
            <!-- <div *ngIf="!showPdfPreview" class="col-sm-12 col-md-12 col-lg-12 text-center">
                <i class="fa fa-circle-o-notch fa-spin" style="font-size:48px;"></i>
                <br /> Please wait while we are loading preview
            </div> -->
            <div class="col-sm-12 col-md-12 col-lg-12">
                <iframe style="width: 100%;height: 450px;" frameborder="0"></iframe>
            </div>
            <div class="col-sm-12 col-md-12 col-lg-12 text-right" style="margin-top: 30px;">
                <button type="button" class="btn btn-warning" (click)="closePdfPreviewModal()">Cancel</button>
                <button type="button" *ngIf="factFinderHistoryObj['approvedByClient']" class="btn btn-primary" [disabled]="!showPdfPreview"
                    (click)="getFactFinderHtmlDoc()">Make Changes</button>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #factFinderFormModal>
    <div class="modal-header">
        <button type="button" [disabled]="updateFactFinderLoader" (click)="closeFactFinderFormModal()" class="close">
            <span aria-hidden="true">&times;</span>
        </button>
        <h3 class="modal-title">Fact Finder Form</h3>
    </div>
    <div class="modal-body">
        <div class="row">
            <!-- <div id="loadHtml" [innerHtml]="htmlDoc | safeHtml" class="col-sm-12 col-md-12 col-lg-12">
            </div> -->
            <div id="loadHtml" name="factFinderFrame" class="col-sm-12 col-md-12 col-lg-12">
                <!-- use frame here -->
                <iframe id="iframeId" frameborder="0" style="width: 100%;height: 400px;"></iframe>
            </div>
            <div class="col-sm-12 col-md-12 col-lg-12 text-right" style="margin-top: 30px;">
                <button type="button" class="btn btn-warning" [disabled]="updateFactFinderLoader" (click)="closeFactFinderFormModal()">Cancel</button>
                <button type="button" class="btn btn-primary" [disabled]="updateFactFinderLoader" (click)="writeReviewToAdvisor()">Submit</button>
                <img *ngIf="updateFactFinderLoader" src="/assets/img/loader/spin.gif" />
            </div>
        </div>
    </div>
</ng-template>

<ng-template #reviewFormModal>
    <div class="modal-header">
        <button type="button" (click)="closeReviewFormModal()" class="close">
            <span aria-hidden="true">&times;</span>
        </button>
        <h3 class="modal-title">Review</h3>
    </div>
    <div class="modal-body">
        <div class="row">
            <div class="col-sm-12 col-md-12 col-lg-12">
                <textarea [(ngModel)]="remarksModalText" row="2" class="form-control" placeholder="Review"></textarea>
            </div>
            <div class="col-sm-12 col-md-12 col-lg-12 text-right" style="margin-top: 30px;">
                <button type="button" class="btn btn-warning" (click)="closeReviewFormModal()">Cancel</button>
                <button type="button" class="btn btn-primary" (click)="updateHtmlFormData()">Done</button>
            </div>
        </div>
    </div>
</ng-template>

<!-- otp Model-->
<ng-template #otpModal>
    <div class="modal-header">
        <button type="button" class="close" (click)="closeOtpModal()">
            <span aria-hidden="true">&times;</span>
        </button>
        <h5>Otp Required</h5>
    </div>
    <div class="modal-body">
        <div class="row">
            <form (submit)="otpForm.form.valid && verifyOtp(otpObj)" #otpForm="ngForm" role="form">
                <div class="col-md-12 text-center">
                    <p>An OTP has been sent to your registered email Id. Please check your email</p>
                </div>
                <div class="col-md-12" align="center">
                    <div class="row">
                        <div class="col-md-3">
                        </div>
                        <div class="col-md-6">
                            <div class="form-group" [ngClass]="{ 'has-error': otpForm.submitted && !verifyOtpRefVar.valid }">
                                <input class="form-control" name="statementPass" type="password" [(ngModel)]="otpObj.verify_otp" #verifyOtpRefVar="ngModel"
                                    required>
                                <span class="help-block" *ngIf="otpForm.submitted && !verifyOtpRefVar.valid">One Time Password is required</span>
                            </div>
                        </div>
                        <div class="col-md-3"></div>
                    </div>
                </div>
                <div class="col-sm-12 text-center" style="margin-top: -2%;">
                    <label id="otpErrorPass" class="pm-red"></label>
                </div>
                <div class="col-md-12 text-center">
                    <button type="button" class="pm-stmt-pass-btn" (click)="closeOtpModal()" style="margin-right: 10px;">Cancel</button>
                    <button type="submit" class="pm-stmt-pass-btn">Ok</button>
                    <!-- <i *ngIf="verifyOtpLoader" class="fa fa-spinner glyphicon-refresh-animate"></i> -->
                </div>
            </form>
        </div>
    </div>
</ng-template>

<!-- Notification component -->
<app-common-notification #notificationComponent></app-common-notification>