<div class="b47PM-wrapper logged-in">
  <!-- "logged-in" add this class when user login successfully -->

  <!-- Header Part Html Starts -->
  <app-authorised-header></app-authorised-header>
  <!-- Header Part Html Ends -->

  <!-- Loader section -->
  <div class="b47PM-center-body" *ngIf="!displayTransactionPage" > <!--  *ngIf="!overviewPageLoad && !overviewError" -->
    <div class="container-fluid b47PM-container investment-landing-page">
      <div class="row clearfix">
        <div class="col-md-12">
          <div class="b47PM-investment-quad1" align="center">
            <div class="col-sm-8 col-sm-offset-2">
              <img src="/assets/img/loader/page_loading.gif">
            </div>
          </div>
          <div class="clearfix"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- main display start when there is no transaction -->
  <div class="b47PM-center-body" *ngIf="displayTransactionPage && transactions.length == 0">
      <div class="container-fluid b47PM-container goals-landing-page">
        <div class="row clearfix">
          <div class="col-md-12">
            <button class="b47PM-default-btn pull-left" data-toggle="modal" data-target=".addTransactiondModal" (click)="prepareAddTransaction();loadAddAccountDropdown()">ADD TRANSACTION</button>
          </div>   
        </div>
        <div class="row clearfix">
          <div class="col-md-12">
            <div class="b47PM-budget-quad1 grey-quad" align="center">
              <div class="col-sm-8 col-sm-offset-2">
                <!--<img src="../img/goals/goal-icon.png" alt="">-->
                <p>
                  You do not have any transactions to show. Get started by adding an account or transactions
                </p>
                <!--<h4>Set your Goals, Get Started!</h4>-->
              </div>
              <div class="clearfix"></div>
            </div>
          </div>  
        </div>
      </div>
    </div>
    <!-- main display start when there is no transaction end -->

  <!-- Main Display Html Starts -->
  <div class="b47PM-center-body" *ngIf="displayTransactionPage && transactions.length > 0">
    <div class="container-fluid b47PM-container b47PM-transac-page">
      <h4 style="margin:30px 0 20px 0">Expenses analysis for the current month <span *ngIf="expenseCategoryData.currency" >({{expenseCategoryData.currency}})</span></h4>
      <div class="row clearfix">
        <div class="col-sm-12">
          <div class="b47PM-tran-expense-quad1">
            <div class="row">
              <div class="col-sm-12 col-md-6">
                <div class="b47PM-tran-tubechart-quad1">
                  <div *ngIf="!transactionHeaderChartLoading" id="transaction_hero_content" style="height: 210px;">
                    <canvas id="transaction_hero"></canvas>
                  </div>
                  <div *ngIf="transactionHeaderChartLoading" style="display: table; height: 210px; overflow: hidden;text-align: center;">
                    <div style="display: table-cell; vertical-align: middle;">
                      <!--fetching information<br />-->
                      <img src="/assets/img/loader/preloader.gif" style="width: 50%;">
                    </div>
                  </div>
                  <div class="b47PM-tran-tubechart-uncategorised">
                    <span *ngIf="expenseCategoryData.uncategorisedAmount > 0">
                        <span class="heading-content-style">Your Total Uncategorised Transactions Amount to <span class="graph-heading-number">{{expenseCategoryData.uncategorisedAmount | number:'3.1-5' | currencySymbol:expenseCategoryData.currency}}</span>. &nbsp;<a style="cursor: pointer;" ng-click="filterCategory()">Click</a> to Categorise them now. </span>
                    </span>
                  </div>
                  <div *ngIf="expenseCategoryData.unconfirmedTransactions > 0" class="b47PM-tran-tubechart-uncategorised">
                    <span>
                      <span class="heading-content-style">You have <span class="graph-heading-number">{{expenseCategoryData.unconfirmedTransactions}} </span> unconfirmed transactions from the manual upload, please 
                      <a class="cursor" href="#/transactionpreview">Click</a> here to confirm or reject these transactions. </span>
                    </span>
                  </div>
                </div>
              </div>              
              <div class="col-sm-12 col-md-6">
                <div class="top3expenses-quad">
                  <h5>Top 3 Expenses <span *ngIf="top3expensecategory">for {{top3expensecategory}}</span></h5>
                  <div class="misc-table-showcase">
                    <div class="b47PM-exp-table1">
                      <header>
                        <div class="row clearfix">
                          <div class="col-xs-3">Date</div>
                          <div class="col-xs-6">Merchant Name</div>
                          <div class="col-xs-3" align="right">Amount</div>
                        </div>
                      </header>
                      <div class="exp-table-body">
                        <div class="row clearfix" *ngFor="let toptxn of topTransactions">
                          <div class="col-xs-3">{{toptxn.transDate | dateFormat: 'DD-MM-YYYY'}}</div>
                          <div class="col-xs-6"><span class="truncatequd" title="{{toptxn.merchantName}}">{{toptxn.merchantName}}</span></div>
                          <div class="col-xs-3" align="right">{{toptxn.amount | number:'3.1-5' | currencySymbol : toptxn.currency}}</div>
                        </div>
                        <div *ngIf="!transactionHeaderChartLoading && topTransactions.length == 0" class="row clearfix text-center">
                          <span>There are no top transactions for this month</span>
                        </div>
                        <div class="row clearfix" *ngIf="transactionHeaderChartLoading" style="display: table; height: 50px; overflow: hidden;text-align: center;">
                          <div style="display: table-cell; vertical-align: middle;">
                            <!--fetching information<br />-->
                            <img src="/assets/img/loader/preloader.gif" style="width: 50%;">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="clearfix"></div>
            </div>
          </div>
        </div>   

      </div>
      <div class="row clearfix">
        <div class="col-xs-12 col-sm-4">
          <button class="b47PM-default-btn pull-left add-trnstn-btn" data-toggle="modal" data-target=".addTransactiondModal" (click)="prepareAddTransaction();loadAddAccountDropdown()">ADD TRANSACTION</button>
        </div>
        <div class="col-xs-12 col-sm-4 pull-right">
          <select class="form-control pull-right" name="pagesize" id="selectRange" style="width:auto; height: 30px; padding: 0 12px; margin: 3px 0 0 9px;" 
              [(ngModel)]="pagesize">
            <option value="10" selected>10</option> 
            <option value="25">25</option>                
            <option value="50">50</option>                
            <option value="75">75</option>            
          </select>
          <span class="pull-right" style="line-height:30px">show</span>
          <!-- <dir-pagination-controls template-url="template/pageshow.html"></dir-pagination-controls> -->
          <!-- <div class="pull-right result-counter"><span ng-if="range.total == 0">0</span><span ng-if="range.total > 0">{{range.lower}}</span>-{{range.upper}} of {{ range.total }}</div> -->
        </div>
      </div>
      <div class="clearfix"></div>
      <div class="b47PM-filter-quad1">
        <div class="row">
          <div class="col-xs-offset-1 col-xs-10 col-sm-offset-0 col-sm-4 col-md-2 rowPusher form-group">
            <div class="row">
              <label>Choose Account Type</label>
              <select class="form-control sideGraphClear" name="accountType" [(ngModel)]="accountType" (change)="pushAccountType()">
                <option value="" selected="selected">All</option>
                <option *ngFor="let type of accountTypes" value="{{ type }}" >{{ type }}</option> <!--  | orderBy -->
              </select>
            </div>
          </div>
          <div class="col-xs-offset-1 col-xs-10 col-sm-offset-0 col-sm-4 col-md-2 rowPusher form-group">
            <div class="row clearfix">
              <label>Choose Account Number</label>
              <select class="form-control sideGraphClear" name="accountNumber" [(ngModel)]="accountNumber" (change)="pushAccountNumber()">
                <option value="" selected>All</option>
                <option *ngFor="let account of accounts" value="{{ account }}">{{ account }}</option>
              </select>
            </div>
          </div>
          <div class="col-xs-offset-1 col-xs-10 col-sm-offset-0 col-sm-4 col-md-2 rowPusher form-group">
            <div class="row">
              <label>Choose Institution</label>
              <select class="form-control sideGraphClear" [(ngModel)]="institutionName" (change)="pushInstitutionName()">
                <option value="" selected>All</option>
                <option *ngFor="let inst of institutions" value="{{ inst }}">{{ inst }}</option>   
              </select>
            </div>
          </div>
          <div class="col-xs-offset-1 col-xs-10 col-sm-offset-0 col-sm-4 col-md-2 rowPusher form-group">
            <div class="row">
              <label>Choose Category</label>
              <select class="form-control sideGraphClear" [(ngModel)]="category" (change)="pushCategory()">
                  <option value="" selected>All</option>
                  <option *ngFor="let category of categories" value=" {{ category }}" >{{ category }}</option>
              </select>
            </div>
          </div>
          <div class="col-xs-offset-1 col-xs-10 col-sm-offset-0 col-sm-4 col-md-2 rowPusher form-group">
            <div class="row">
              <label>Choose Merchant</label>
              <select class="form-control sideGraphClear" [(ngModel)]="merchantName" (change)="pushMerchantName()">
                <option value="" selected>All</option>
                <option *ngFor="let merchant of merchants" value="{{ merchant }}">{{ merchant }}</option>
              </select>
            </div>
          </div>
         <!--  <div class="col-xs-offset-1 col-xs-10 col-sm-offset-0 col-sm-4 col-md-2 rowPusher form-group">
            <div class="row">
              <label>Choose Tags</label>
              <select class="form-control sideGraphClear hideEmptyOptions" [(ngModel)]="tag" (change)="pushTags()">
                <option value="" ng-selected="true">All</option>
                <option *ngFor="let tag of tags" value="{{tag}}">{{tag}}</option>
              </select>
            </div>
          </div> -->
          <div class="col-xs-offset-1 col-xs-10  col-sm-offset-0 col-sm-12">
            <div class="row">
              <ng-container *ngIf="Filter['accountType'].length > 0">
                  <div class="filter-box" *ngFor="let accountType of Filter.accountType">
                      <span [innerHtml]="accountType"></span>
                      <i class="fa fa-times" aria-hidden="true" (click)="spliceAccountType($index);" role="button"></i>
                    </div>
              </ng-container>
              <ng-container *ngIf="Filter['accountNumber'].length > 0">
                  <div class="filter-box" *ngFor="let accountNumber of Filter.accountNumber">
                      <span [innerHtml]="accountNumber"></span>
                      <i class="fa fa-times" aria-hidden="true" (click)="spliceAccountNumber($index);" role="button"></i>
                    </div>
              </ng-container>
              <ng-container *ngIf="Filter['institutionName'].length > 0">
                  <div class="filter-box" *ngFor="let institutionName of Filter.institutionName">
                      <span [innerHtml]="institutionName"></span>
                      <i class="fa fa-times" aria-hidden="true" (click)="spliceInstitutionName($index);" role="button"></i>
                    </div>
              </ng-container>
              <ng-container *ngIf="Filter['category'].length > 0">
                  <div class="filter-box" *ngFor="let category of Filter.category">
                      <span [innerHtml]="category"></span>
                      <i class="fa fa-times" aria-hidden="true" (click)="spliceCategory($index)" role="button"></i>
                    </div>
              </ng-container>
              <ng-container *ngIf="Filter['merchantName'].length > 0">
                  <div class="filter-box" *ngFor="let merchantName of Filter.merchantName">
                    <span [innerHtml]="merchantName"></span>
                    <i class="fa fa-times" aria-hidden="true" (click)="spliceMerchantName($index);" role="button"></i>
                  </div>
              </ng-container>
              <!-- <ng-container *ngIf="Filter['tags'].length > 0">
                  <div class="filter-box" *ngFor="let tag of Filter.tags">
                    <span [innerHtml]="tag"></span>
                      <i class="fa fa-times" aria-hidden="true" (click)="spliceTags($index);" role="button"></i>
                  </div>
              </ng-container> -->
              
              <div class="clear-filter-box" *ngIf="Filter['accountType'].length != 0
                || Filter['accountNumber'].length != 0 || Filter['institutionName'].length != 0 
                || Filter['category'].length != 0 || Filter['merchantName'].length != 0 || Filter['tags'].length != 0">
                <a role="button" (click)="clearAllFilter()">
                  Clear All
                </a>
              </div>
            </div>                
          </div>
        </div>
      </div>
      <div class="row clearfix">
        <div class="col-sm-12 col-md-9">
          <div class="misc-table-showcase">
            <div class="table b47PM-misc-table1 b47PM-transac-tbl1 b47PM-transaction-tbl1">
              <header class="clearfix">
                <div>DATE</div>
                <div>MERCHANT NAME</div>
                <div>CATEGORY</div>
                <div style="text-align: center;">AMOUNT</div>
                <div style="text-align:center;">ACTION</div>
              </header>
              <div> <!-- this if for alternate row colors -->
                <div *ngFor="let transaction of transactions | searchFilter:Filter.accountType | searchFilter:Filter.accountNumber | searchFilter:Filter.institutionName 
                  | searchFilter:Filter.category | searchFilter:Filter.merchantName | searchFilter:Filter.tags | paginate: { itemsPerPage: pagesize, currentPage: p }; let i = index" class="record-row transc-row"> <!--  (click)="loadDropdown()" -->
                  <table width="100%" class="table inner-data-table">
                    <thead class="edit_no" id="{{transaction.id}}" style="cursor: pointer;"> <!-- val1="{{transaction.category}}" -->
                      <tr (click)="editTransaction(i, transaction, $event)">
                        <th>
                          <span *ngIf="!transaction.editTxn" id="date_{{transaction.id}}" class="text">{{ transaction.transDate | dateFormat: 'DD-MM-YYYY'}}</span>
                          <span *ngIf="transaction.editTxn">
                            <my-date-picker name="mydate1" [options]="myDatePickerOptions" [(ngModel)]="editTransactionObj.updatedTransDate"
                              (dateChanged)="onTxnDateChanged($event)" id="date_input_{{transaction.id}}"></my-date-picker>
                          </span>
                        </th>
                        <th class="break-word">
                          <div bs-popover>
                            <span [hidden]="transaction.editTxn" id="merchant_{{transaction.id}}" class="text word-wrap" rel="popover">{{ transaction.merchantName }}</span> <!-- data-content="{{transaction.description}}" -->
                          </div>
                          <span *ngIf="transaction.editTxn">
                            <input name="merchant_name" type="text" auto-complete [source]="merchantList"
                              [(ngModel)]="editTransactionObj.updatedMerchantName" [list-formatter]="autocompleListFormatter"
                              value-property-name="id" display-property-name="name" placeholder="Merchant name" class="form-control restrictSplChr" id="merchant_input_{{transaction.id}}" required>
                          </span>
                        </th>
                        <!--<th class="truncatequd" title="{{ category }}">
                          <span class="category-icon pull-left"><img src="img/category-icons/buissness-expense.png" alt="" width="20px"></span>
                          {{ transaction.subcategory }}
                        </th>-->
                        <th>
                          <span class="category-icon pull-left" style="vertical-align:middle"><img src="/assets/{{transaction.categoryImageUrl}}" id="image_{{transaction.id}}" alt="" width="20px" title="{{transaction.category}}"></span>
                          <span *ngIf="!transaction.editTxn" id="subcategory_{{transaction.id}}" class="text" >{{transaction.subcategory}}</span>
                  
                          <input type="hidden" [(ngModel)]="editTransactionObj.updatedCategory" id="category_{{transaction.id}}">
                  
                          <!-- category subcategory dropdown start -->
                          <div *ngIf="transaction.editTxn" class="transaction-select" style="vertical-align:middle;display: table-cell;" id="subcategory_input_{{transaction.id}}">
                              <ul id="main-menu_{{transaction.id}}" class="sm sm-blue mainmenu" style="width: 95%;border-radius: 0px;">
                                  <li style="width: 100%;">
                                      <a href="javascript: void(0);" class="transaction-select">
                                          <input *ngIf="transaction.editTxn" type="text" name="changeCategoryName" [(ngModel)]="editTransactionObj.updatedSubcategory" class="form-control inline-category" id="subcategory_inputbox_{{transaction.id}}"
                                                placeholder="subcategory" onkeydown="return false;" onDrop="return false" onPaste="return false">
                                      </a>
                                      <ul style="z-index: 9999;">
                                          <li *ngFor="let category of categorySubCategoryLists | orderBy: 'name'"> <!--  | orderBy: 'categoryName' -->
                                              <a>{{category.name}}</a>
                                              <ul>
                                                  <li *ngFor="let subcategory of category.subcategories">
                                                      <a href="javascript: void(0);" (click)="getCategorySubcategoryInline(transaction, category.name, subcategory.name, category.url)">
                                                          {{subcategory.name}}
                                                      </a>
                                                  </li>
                                                  <!-- <li><a href="" style="font-weight:bold;" data-toggle="modal" data-target=".addSubcategoryModal" >Add Subcategory</a></li> -->
                                              </ul>
                                          </li>
                                      </ul>
                                  </li>
                              </ul>
                          </div>
                          <!-- category subcategory dropdown end -->
                        </th>
                        <th style="text-align: right;">
                          <span *ngIf="!transaction.editTxn">
                            <span *ngIf="transaction.transactionType == 'debit'" id="amount_{{transaction.id}}" class="text pm-red">-{{removeSpecialCharacter(transaction.amount) | number:'1.1-2' | currencySymbol:transaction.currency}}</span>
                            <span *ngIf="transaction.transactionType != 'debit'" id="amount_{{transaction.id}}" class="text" style=" color: #000000;">{{removeSpecialCharacter(transaction.amount) | number:'1.1-2' | currencySymbol:transaction.currency}}</span>
                          </span>
                          <input *ngIf="transaction.editTxn" type="text" [(ngModel)]="editTransactionObj.updatedAmount" class="form-control pointNumber" id="amount_input_{{transaction.id}}"
                                style="text-align: right">
                        </th>
                        <th>
                          <button class="pull-right btn delete-txn-btn" id="deltxnbtn_{{transaction.id}}"
                            (click)="prepareDeleteTxn(i, transaction)" title="Delete" disabled>
                            <img src="/assets/img/transaction/delete1.svg" width="18px">
                          </button>
                          <!-- <button class="pull-right btn split-txn-btn" id="splittxnbtn_{{transaction.id}}" (click)="showTransactionSplit($event, transaction)" title="Split" disabled>
                            <img src="/assets/img/transaction/split1.svg" width="30px">
                          </button>
                          <button class="pull-right btn edit-txn-btn" id="edittxnbtn_{{transaction.id}}" (click)="showTransactionEdit($event, transaction);loadDropdown()" title="Edit" disabled>
                            <img src="/assets/img/transaction/edit_multiple1.svg" width="25px">
                          </button> -->
                          <div class="clearfix"></div>
                        </th>
                      </tr>
                      <tr *ngIf="transaction.editTxn" style="text-align: center">
                        <td colspan="9" class="filter-button">
                          <span class="pm-red" id="txnError_{{i}}" style="display: block;"></span>
                          <button type="button" class="btn btn-primary" (click)="saveTransaction(i, transaction)">Save</button>
                          <button type="button" class="btn btn-warning" (click)="cancelTransaction(i, transaction)">Cancel</button>
                          <img style="padding: 5px 4px 4px 7px;" *ngIf="transaction.transactionDataLoading" src="/assets/img/loader/spin.gif" />
                        </td>
                      </tr>
                    </thead>
                    <tbody class="editmultitxn" id="editmultitxn_{{transaction.id}}" style="display: none;">
                      <tr>
                        <td colspan="5">
                          <div class="row clearfix" style="padding:15px 0 0 0">
                            <form name="EidtMultiForm" (submit)="updateMultipleTxn(transaction)">
                              <div class="col-md-6">
                                <div class="row clearfix">
                                  <div class="col-md-12 form-group">
                                    <!-- <label>Description <small style="color:#3B5CCF">(This will affect other {{transactionCounts.transactionCount}} transactions)</small></label> -->
                                    <input type="text" name="description" [(ngModel)]="updateTxnObject.description" class="form-control" disabled>
                                  </div>
                                  <h5 class="col-md-12">Current name</h5>
                                  <div class="col-md-6 form-group">
                                    <label>Merchant</label>
                                    <input type="text" name="merchantName" [(ngModel)]="updateTxnObject.merchantName" class="form-control" disabled>
                                  </div>
                                  <div class="col-md-6 form-group">
                                    <label>Category</label>
                                    <p style="display: table;">
                                      <span class="category-icon" style="vertical-align:middle;display: table-cell;padding-right: 8px;"><img src="/assets/{{updateTxnObject.categoryImageUrl}}" alt="" width="20px"></span>
                                      <input type="text" name="category" style="vertical-align:middle;display: table-cell;" [(ngModel)]="updateTxnObject.category" class="form-control" disabled>
                                    <p>
                                  </div>
                                  <h5 class="col-md-12">Rename To</h5>
                                  <div class="col-md-6 form-group">
                                    <label>Merchant</label>
                                    <input type="text" name="changeMerchantName" auto-complete ui-items="merchantList" [(ngModel)]="updateTxnObject.merchantName" class="form-control" required>
                                  </div>
                                  <div class="col-md-6 form-group">
                                    <label>Category</label>
                                    <!--<input type="text" [(ngModel)]="updateTxnObject.changeCategory" ng-init="updateTxnObject.changeCategory = updateTxnObject.category" class="form-control">-->
                                    <div style="display: table;">
                                      <span style="vertical-align:middle;padding-right: 16px;"><img src="/assets/{{updateTxnObject.categoryImageUrl}}" height="20px" width="20px" id="image1_{{updateTxnObject.id}}" title="{{updateTxnObject.category}}"></span>
                                      <div style="vertical-align:middle;display: table-cell;">
                                        <ul id="main-menu1" class="sm sm-blue mainmenu" style="width: 100%;border-radius: 0px;vertical-align:middle;display: table-cell;">
                                          <li style="width: 100%;"><a href="javascript: void(0);">
                                                  <input type="text" style="height: 35px;" placeholder="Choose Subcategory..." id="category2_{{updateTxnObject.id}}" name="changeCategoryName" onkeydown="return false;"
                                                        [(ngModel)]="updateTxnObject.category" hidden>
                  
                                                  <input type="text" style="height: 35px;width: 100%;" class="form-control" placeholder="Choose a category..." id="subcategory2_{{ updateTxnObject.id }}"  name="changeSubCategoryName" onkeydown="return false;" 
                                                  [(ngModel)]="updateTxnObject.subcategory" onDrop="return false" onPaste="return false">
                                              </a>
                                              <ul style="z-index: 9999;">
                                                  <li *ngFor="let category of categorySubCategoryLists | orderBy: 'name'"> <!--  | orderBy: 'categoryName' -->
                                                      <a>{{category.name}}</a>
                                                      <ul>
                                                          <li *ngFor="let subcategory of category.subcategories">
                                                              <a href="javascript: void(0);" (click)="getCategorySubcategoryEdit(updateTxnObject.id,category.name,subcategory.name,category.url)">
                                                                  {{subcategory.name}}
                                                              </a>
                                                          </li>
                                                          <!-- <li><a href="" style="font-weight:bold;" data-toggle="modal" data-target=".addSubcategoryModal">Add Subcategory</a></li> -->
                                                      </ul>
                                                  </li>
                                              </ul>
                                          </li>
                                        </ul>
                                      </div>
                  
                                    </div>
                                  </div>
                                </div>
                                <!-- <div style="padding-left: 0px !important; vertical-align: middle; margin-top: 0;" class="col-md-6">
                                  <input name="updateAllFlag" value="0" checked="checked" style="width:50px;" type="radio"><span style="font-size:15px;vertical-align: text-bottom;">This Transaction</span>
                                </div>
                                <div style="padding-left: 0px !important; vertical-align: middle; margin-top: 0;" class="col-md-6">
                                  <input name="updateAllFlag" value="1" style="width:50px;" type="radio"><span style="font-size:15px;vertical-align: text-bottom;">Similar Transactions</span>
                                </div> -->
                              </div>                                  
                              <div class="col-md-6 colSep1">
                                <div class="row clearfix">
                                  <!-- <div class="col-md-12 form-group">
                                    <label>Tags</label>
                                    <input type="text" name="changeTags" [(ngModel)]="updateTxnObject.tag" class="form-control">
                                  </div>
                                  <h5 class="col-md-12">&nbsp;</h5> -->
                                  <div class="col-md-12 form-group">
                                    <label>Notes</label>
                                    <textarea name="changeNarration" [(ngModel)]="updateTxnObject.narration" class="form-control" style="min-height:143px"></textarea>
                                  </div>
                                </div>
                              </div>
                  
                              <div class="col-md-12 clearfix">
                                <hr style="margin:15px 0 15px 0">
                                <button type="submit" class="btn b47PM-default-btn" ng-disabled="vm.editMulTxnDataLoading" style="margin:0 10px 8px 0">UPDATE</button>
                                <img *ngIf="editMulTxnDataLoading" src="/asstes/img/loader/spin.gif" />
                                <button type="button" class="btn b47PM-dCancel-btn" id="{{transaction.id}}" style="margin:0 10px 8px 0" (click)="cancelEditTransaction($event)">CANCEL</button>
                              </div>
                            </form>                               
                          </div>
                        </td>
                      </tr>
                    </tbody>
                    <tbody class="splittxn" id="splittxn_{{transaction.id}}" style="display: none;">
                      <tr>
                        <td colspan="5">
                          <div class="row clearfix" style="padding:15px 0 0 0">
                            <form method="post" accept-charset="utf-8" (submit)="splitTransactionDetails(transaction.id)">
                              <div class="col-md-12 splited-row">
                                <hr>
                                <div class="row">
                                  <div class="col-md-2 form-group">
                                    <label>Date</label><br>
                                    <input type="text" name="splittransaction" date='dd-mm-yyyy' class="form-control" value="{{splitTxnObject.transDate | dateFormat: 'DD-MM-YYYY'}}" readonly>
                                  </div>
                                  <div class="col-md-2 form-group">
                                    <label>Merchant Name</label>
                                    <input type="text" name="splitmerchantName" class="form-control" [(ngModel)]="splitTxnObject.merchantName" readonly>
                                  </div>
                                  <div class="col-md-2 form-group">
                                    <label>Category</label>
                                    <input type="text" name="splitcategory" class="form-control" [(ngModel)]="splitTxnObject.category" readonly>
                                  </div>
                                  <div class="col-md-2 form-group">
                                    <label>&nbsp;</label>
                                    <input type="text" name="splitsubcategory" class="form-control" [(ngModel)]="splitTxnObject.subcategory" readonly>
                                  </div>
                                  <div class="col-md-2 form-group">
                                    <label>Amount</label>
                                    <input type="text" name="splitsubcategory" class="form-control" style="text-align: right;" id="txn_amount_{{splitTxnObject.id}}" [(ngModel)]="remainingAmount" readonly>
                                  </div>
                                  <div class="col-md-2 form-group">
                                    <label>&nbsp;</label><br>
                                    <button type="button" class="btn b47PM-default-btn" style="line-height:33px" (click)="newSplitRow();dropdownsplit();">SPLIT</button>
                                  </div>
                                </div>
                              </div>
                              <div class="col-md-12 splited-row">
                                <hr>
                                <div class="row clearfix" *ngFor="let item of splitTransactionList.lists">
                                  <div class="col-md-2 form-group">
                                    <input type="text" name="splittransDate" class="form-control" [(ngModel)]="item.transDate" required jqdatepicker readonly>
                                  </div>
                                  <div class="col-md-2 form-group">
                                    <input type="text" name="splitmerchantName" class="form-control" auto-complete ui-items="merchantList" [(ngModel)]="item.merchantName" required>
                                  </div>
                                  <div class="col-md-2 form-group">
                                    <!--<input type="text" class="form-control" [(ngModel)]="item.category" required>-->
                                    <ul class="sm sm-blue mainmenu3">
                                      <li style="width: 100%;">
                                        <a href="javascript: void(0);">
                                          <input type="text" class="form-control"
                                              placeholder="Choose Category..." id="split_category_{{splitTxnObject.id}}_{{$index}}" name="category_name" [(ngModel)]="item.category" onkeydown="return false;" onDrop="return false" onPaste="return false" autocomplete="off" required>
                  
                                        </a>
                                        <ul style="z-index: 9999;">
                                          <li *ngFor="let category of categorySubCategoryLists | orderBy: 'name'"> <!--  | orderBy: 'categoryName' -->
                                            <a>{{category.name}}</a>
                                            <ul>
                                              <li *ngFor="let subcategory of category.subcategories">
                                                <a href="javascript: void(0);" (click)="getCategorySubcategorysplit(i, splitTxnObject.id, category.name,subcategory.name)">
                                                  {{subcategory.name}}
                                                </a>
                                              </li>
                                            </ul>
                                          </li>
                                        </ul>
                                      </li>
                                    </ul>
                                  </div>
                                  <div class="col-md-2 form-group">
                                    <input type="text" class="form-control" name="subcategory" id="split_subcategory_{{splitTxnObject.id}}_{{$index}}" [(ngModel)]="item.subcategory" onkeydown="return false;" onDrop="return false" onPaste="return false" autocomplete="off" required>
                                  </div>
                                  <div class="col-md-2 form-group">
                                    <input type="text" class="form-control pointNumber" name="amount" style="text-align: right;" [(ngModel)]="item.amount" (keyup)="validateAmount(splitTxnObject.amount, splitTxnObject.id)" required>
                                  </div>
                                  <div class="col-md-2 form-group">
                                    <button type="button" class="btn cancel-split-operation" style="line-height:33px" (click)="removeSplitRow($index);validateAmount(splitTxnObject.amount, splitTxnObject.id)">
                                      <i class="fa fa-times-circle-o" aria-hidden="true"></i>
                                    </button>
                                  </div>
                                </div>
                                <div class="row clearfix">
                                  <div class="col-md-12" id="spliterrormsg">
                  
                                  </div>
                                </div>
                              </div>
                              <div class="col-md-12 clearfix">
                                <hr style="margin:15px 0 15px 0">
                                <button type="submit" class="btn b47PM-default-btn splitsubmit" [disabled]="splitTxnDataLoading" style="margin:0 10px 8px 0">SUBMIT</button>
                                <img *ngIf="splitTxnDataLoading" src="/assets/img/loader/spin.gif" />
                                <button type="button" class="btn b47PM-dCancel-btn" id="{{splitTxnObject.id}}" style="margin:0 10px 8px 0" (click)="cancelSplitTransaction($event)">CANCEL</button>
                              </div>
                            </form>                                 
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div *ngIf="(transactions | searchFilter:Filter.accountType | searchFilter:Filter.accountNumber | searchFilter:Filter.institutionName 
                | searchFilter:Filter.category | searchFilter:Filter.merchantName | searchFilter:Filter.tags).length == 0" style="padding: 10px;text-align: center;">
                <div class="record-row transc-row" style="background-color: #F6F6F6;padding: 0.6%;">
                  There are no transactions matching this criteria
                </div>
              </div>
            </div>
            <!---->
            <div class="row">
              <div class="col-md-12 text-right">
                <pagination-controls (pageChange)="p = $event" class="pm-pagination"></pagination-controls>
              </div>
            </div>
            <!-- <dir-pagination-controls template-url="template/paginate_control.html"></dir-pagination-controls> -->
          </div>
        </div>
        <div class="col-sm-12 col-md-3">
          <div class="record-grph-quad1" id="category_chart_div">
            <header>
              <h5>Cash Flows over 3 months</h5>
            </header>
            <div class="record-grph" id="chart_div_content" style="height: 300px">
              <canvas id="chart_div"></canvas>
            </div>
          </div>
        </div>
      </div>
      <div class="clearfix"></div>
    </div>
  </div>
  <!-- Main Display Html Ends -->

  <!-- Footer Part Html Starts -->
  <!-- <div class="b47PM-footer clearfix" ng-include="'template/afterloginfooter.html'"></div>  -->
  <app-authorised-footer></app-authorised-footer>
  <!-- Footer Part Html Ends -->

</div>

<ng-template #addTransactionModal>
  <div class="modal-header">
    <button type="button" class="close" (click)="closeAddTransactionModal()" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
    <h5>Add Transaction</h5>
  </div>
  <form name="addTransactionForm" (submit)="addTransaction()">
    <div class="modal-body">
      <div class="row clearfix">
        <div class="col-xs-12 col-sm-7 form-group">
          <select name="account_type" class="form-control" [(ngModel)]="addTrans.accountType" required>
            <option value="">Select account</option>
            <option *ngFor="let type of accountTypesData" value="{{type.code}}">{{ type.name }}</option>                   
          </select>
        </div>

        <div class="col-xs-12 col-sm-7 form-group">
          <select class="form-control" name="manualCountry" [(ngModel)]="addTrans.countryCode" (change)="fetchInstitutions(addTrans)" required>
            <option value="">Select country</option>
            <option *ngFor="let country of statementCountries" [value]="country.code">{{country.name}}</option>
          </select>
        </div>

        <div class="clearfix"></div>
        <div class="col-xs-12 col-sm-7 form-group">
          <!-- <input name="inst_name" type="text" class="form-control restrictSplChr" appAutoComplete uiItems="{{institutionList}}" placeholder="Institution Name" [(ngModel)]="addTrans.institutionName" required> -->
          <select class="form-control" name="manualInst" [(ngModel)]="addTrans.institutionCode" required>
              <option value="">Select institution</option>
              <option *ngFor="let stmtInst of statementInstitutions" [value]="stmtInst.code">{{stmtInst.name}}</option>
            </select>
        </div>

        <div class="clearfix"></div>
        <div class="col-xs-12 col-sm-7 form-group">
            <!-- auto-complete [(ngModel)]="myData"  -->
          <input name="merchant_name" type="text" auto-complete [source]="merchantList"
            [(ngModel)]="addTrans.merchantName" [list-formatter]="autocompleListFormatter"
            value-property-name="id" display-property-name="name" placeholder="Merchant name" class="form-control restrictSplChr" required>
        </div>

        <div class="clearfix"></div>
        <div class="col-xs-12 col-sm-7 form-group">
          <ul class="sm sm-blue mainmenu2">
              <li style="width: 100%;">
                  <a href="javascript: void(0);">
                      <input type="text" class="form-control"
                              placeholder="Choose Category..." id="category1" name="category_name" [(ngModel)]="addTrans.category" onkeydown="return false;" onDrop="return false" onPaste="return false" autocomplete="off" required>

                  </a>
                  <ul style="z-index: 9999;">
                      <li *ngFor="let category of categorySubCategoryLists | orderBy: 'name'"> <!--  | orderBy: 'categoryName' -->
                          <a>{{category.name}}</a>
                          <ul>
                              <li *ngFor="let subcategory of category['subcategories']">
                                  <a href="javascript: void(0);" (click)="getCategorySubcategoryAddTrans(category.name,subcategory.name)">
                                      {{subcategory.name}}
                                  </a>
                              </li>
                          </ul>
                      </li>
                  </ul>
              </li>
          </ul>
        </div>

        <div class="col-xs-12 col-md-7 form-group">
          <input type="text" class="form-control" placeholder="SubCategory..." id="subcategory1" [(ngModel)]="addTrans.subcategory" name="subcategory_name" onkeydown="return false;" autocomplete="off" required>
        </div>

        <div class="clearfix"></div>
        <div class="col-xs-12 col-md-7 form-group">
          <select name="credit_debit" class="form-control" [(ngModel)]="addTrans.creditDebit" required>
            <option value="">Choose Income/Expenses...</option>
            <option *ngFor="let txnType of transactionTypesData" value="{{txnType.key}}">{{txnType.value}}</option>
          </select>
        </div>

        <div class="col-xs-12 col-md-7 form-group">
          <select name="currency" class="form-control selectedCurrency" id="currency_type" [(ngModel)]="addTrans.currency" required>
            <option value="">Select currency</option>
            <optgroup label="Popular Currencies">
              <option *ngFor="let currency of popularCurrencyList" value="{{currency.code}}">{{currency.name}} ({{currency.code}})</option> <!--  | orderBy -->                     
            </optgroup>
            <optgroup label="All Currencies">
              <option *ngFor="let currency of currencyListData" value="{{currency.code}}">{{currency.name}} ({{currency.code}})</option>                     
            </optgroup>    
          </select>
        </div>

        <div class="clearfix"></div>
        <div class="col-xs-12 col-md-7 form-group">
          <input name="amount" type="text" class="form-control number" value="" placeholder="Amount" [(ngModel)]="addTrans.amount" required maxlength="10" autocomplete="off">
        </div>

        <div class="col-xs-12 col-md-7 form-group">
          <!-- <input name="transaction_date" type="text" class="form-control addtransDate" placeholder="DD-MM-YYYY" [(ngModel)]="addTrans.transDate" required readonly> -->
          <my-date-picker name="mydate1" [options]="myDatePickerOptions" [(ngModel)]="addTrans.transDate"></my-date-picker>
        </div>

        <div class="clearfix"></div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="submit" class="btn add-account-btn b47PM-default-btn" [disabled]="addTxnDataLoading">ADD TRANSACTION</button>
      <img *ngIf="addTxnDataLoading" src="/assets/img/loader/spin.gif" />
      <!-- ".disabled" Remove disable class when all Fields are validated-->
    </div>
  </form>
</ng-template>

<ng-template #deleteTransactionModal>
  <div class="modal-header">
    <button type="button" (click)="closeDeleteTransactionModal()" class="close" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="row clearfix">
      <div class="col-md-12" align="center">
        <p>Are you sure want to delete transaction permanently.</p>
      </div>
      <div class="col-md-12" align="center">
        <input type="button" class="b47PM-deltran-btn" [disabled]="delTxnDataLoading" value="DELETE" (click)="deleteTransaction()">
        <img *ngIf="delTxnDataLoading" src="/assets/img/loader/spin.gif" />
        <input type="button" (click)="closeDeleteTransactionModal()" class="b47PM-dCancel-btn" data-dismiss="modal" value="CANCEL">
      </div>
    </div>
  </div>
</ng-template>

<!-- Notification component -->
<app-common-notification [notificationMessage]="notificationMessage" #notificationComponent></app-common-notification>